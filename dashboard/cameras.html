<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cameras - TrueVault VPN</title>
    <link rel="stylesheet" href="assets/css/dashboard.css">
</head>
<body>
    <div id="app">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><span class="logo-icon">üîê</span><span class="logo-text">TrueVault</span></div>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item"><span class="nav-icon">üè†</span><span class="nav-text">Dashboard</span></a>
                <a href="connect.html" class="nav-item"><span class="nav-icon">üîå</span><span class="nav-text">Connect</span></a>
                <a href="servers.html" class="nav-item"><span class="nav-icon">üñ•Ô∏è</span><span class="nav-text">Servers</span></a>
                <a href="devices.html" class="nav-item"><span class="nav-icon">üì±</span><span class="nav-text">Devices</span></a>
                <a href="cameras.html" class="nav-item active"><span class="nav-icon">üì∑</span><span class="nav-text">Cameras</span></a>
                <a href="scanner.html" class="nav-item"><span class="nav-icon">üîç</span><span class="nav-text">Scanner</span></a>
                <a href="certificates.html" class="nav-item"><span class="nav-icon">üìú</span><span class="nav-text">Certificates</span></a>
                <a href="settings.html" class="nav-item"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-text">Settings</span></a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <span class="user-avatar" id="userAvatar">U</span>
                    <div class="user-details">
                        <span class="user-name" id="userName">Loading...</span>
                        <span class="user-plan" id="userPlan">Free</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1 class="page-title">IP Cameras</h1>
                <button class="btn btn-primary" onclick="showAddCamera()">+ Add Camera</button>
            </header>

            <div class="content-area">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üì∑</div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalCameras">0</span>
                            <span class="stat-label">Total Cameras</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üü¢</div>
                        <div class="stat-info">
                            <span class="stat-value" id="onlineCameras">0</span>
                            <span class="stat-label">Online</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî¥</div>
                        <div class="stat-info">
                            <span class="stat-value" id="offlineCameras">0</span>
                            <span class="stat-label">Offline</span>
                        </div>
                    </div>
                </div>

                <!-- Info Banner -->
                <div class="info-banner">
                    <span class="info-icon">üí°</span>
                    <div class="info-content">
                        <h4>Remote Camera Access</h4>
                        <p>Access your IP cameras from anywhere using TrueVault's secure port forwarding. Use the Network Scanner to auto-detect cameras on your local network.</p>
                        <a href="scanner.html" class="btn btn-secondary">Open Scanner</a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>My Cameras</h3>
                    </div>
                    <div class="camera-grid" id="cameraGrid">
                        <div class="empty-state">
                            <span class="empty-icon">üì∑</span>
                            <p>No cameras configured yet</p>
                            <p class="text-muted">Use the scanner to auto-detect cameras on your network</p>
                            <button class="btn btn-primary" onclick="window.location='scanner.html'">Open Scanner</button>
                        </div>
                    </div>
                </div>

                <!-- Supported Cameras -->
                <div class="card">
                    <div class="card-header">
                        <h3>Supported Camera Brands</h3>
                    </div>
                    <div class="brand-grid">
                        <div class="brand-item"><span>üè†</span> Geeni</div>
                        <div class="brand-item"><span>üìπ</span> Wyze</div>
                        <div class="brand-item"><span>üé•</span> Hikvision</div>
                        <div class="brand-item"><span>üì∑</span> Dahua</div>
                        <div class="brand-item"><span>üîí</span> Amcrest</div>
                        <div class="brand-item"><span>üé¨</span> Reolink</div>
                        <div class="brand-item"><span>üö™</span> Ring</div>
                        <div class="brand-item"><span>üè°</span> Nest</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Camera Modal -->
    <div class="modal" id="addCameraModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Camera</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Camera Name</label>
                    <input type="text" id="cameraName" placeholder="e.g., Front Door">
                </div>
                <div class="form-group">
                    <label>Local IP Address</label>
                    <input type="text" id="cameraIP" placeholder="e.g., 192.168.1.50">
                </div>
                <div class="form-group">
                    <label>Port</label>
                    <input type="number" id="cameraPort" value="554" placeholder="554">
                </div>
                <div class="form-group">
                    <label>Brand</label>
                    <select id="cameraBrand">
                        <option value="geeni">Geeni</option>
                        <option value="wyze">Wyze</option>
                        <option value="hikvision">Hikvision</option>
                        <option value="dahua">Dahua</option>
                        <option value="amcrest">Amcrest</option>
                        <option value="reolink">Reolink</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addCamera()">Add Camera</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let token = localStorage.getItem('truevault_token');
        let user = JSON.parse(localStorage.getItem('truevault_user') || '{}');
        let cameras = [];

        if (!token) window.location.href = '/index.html#login';

        document.getElementById('userName').textContent = user.first_name || 'User';
        document.getElementById('userPlan').textContent = user.is_vip ? 'VIP' : (user.plan || 'Basic');
        document.getElementById('userAvatar').textContent = (user.first_name || 'U')[0].toUpperCase();

        async function loadCameras() {
            try {
                const res = await fetch(`${API_BASE}/cameras/list.php`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.success) {
                    cameras = data.data || [];
                    renderCameras();
                }
            } catch (err) {
                console.error('Failed to load cameras');
            }
        }

        function renderCameras() {
            const grid = document.getElementById('cameraGrid');
            document.getElementById('totalCameras').textContent = cameras.length;
            document.getElementById('onlineCameras').textContent = cameras.filter(c => c.status === 'online').length;
            document.getElementById('offlineCameras').textContent = cameras.filter(c => c.status === 'offline').length;

            if (cameras.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <span class="empty-icon">üì∑</span>
                        <p>No cameras configured yet</p>
                        <button class="btn btn-primary" onclick="window.location='scanner.html'">Open Scanner</button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = cameras.map(c => `
                <div class="camera-card ${c.status}">
                    <div class="camera-preview">
                        <div class="camera-placeholder">
                            <span>üì∑</span>
                            <p>${c.status === 'online' ? 'Live' : 'Offline'}</p>
                        </div>
                    </div>
                    <div class="camera-info">
                        <h4>${c.name}</h4>
                        <p>${c.brand} ‚Ä¢ ${c.ip}:${c.port}</p>
                        <span class="camera-status ${c.status}">${c.status}</span>
                    </div>
                    <div class="camera-actions">
                        <button class="btn btn-small" onclick="viewCamera(${c.id})">View</button>
                        <button class="btn btn-small btn-danger" onclick="removeCamera(${c.id})">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddCamera() { document.getElementById('addCameraModal').classList.add('show'); }
        function closeModal() { document.getElementById('addCameraModal').classList.remove('show'); }

        async function addCamera() {
            const name = document.getElementById('cameraName').value.trim();
            const ip = document.getElementById('cameraIP').value.trim();
            const port = document.getElementById('cameraPort').value;
            const brand = document.getElementById('cameraBrand').value;

            if (!name || !ip) { alert('Please fill in all fields'); return; }

            try {
                const res = await fetch(`${API_BASE}/cameras/add.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ name, ip, port, brand })
                });
                const data = await res.json();
                if (data.success) {
                    closeModal();
                    loadCameras();
                } else {
                    alert(data.error || 'Failed to add camera');
                }
            } catch (err) {
                alert('Error adding camera');
            }
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
        function logout() { localStorage.clear(); window.location.href = '/index.html'; }

        loadCameras();
    </script>

    <style>
        .info-banner { background: rgba(0,217,255,0.1); border: 1px solid rgba(0,217,255,0.3); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; display: flex; gap: 1rem; }
        .info-icon { font-size: 2rem; }
        .info-content h4 { margin-bottom: 0.5rem; }
        .info-content p { color: #888; margin-bottom: 1rem; }
        .camera-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .camera-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; overflow: hidden; }
        .camera-card.online { border-color: rgba(0,255,136,0.3); }
        .camera-card.offline { border-color: rgba(255,80,80,0.3); }
        .camera-preview { height: 160px; background: #0a0a14; display: flex; align-items: center; justify-content: center; }
        .camera-placeholder { text-align: center; }
        .camera-placeholder span { font-size: 3rem; }
        .camera-placeholder p { color: #888; margin-top: 0.5rem; }
        .camera-info { padding: 1rem; }
        .camera-info h4 { margin-bottom: 0.25rem; }
        .camera-info p { color: #888; font-size: 0.85rem; }
        .camera-status { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-top: 0.5rem; }
        .camera-status.online { background: rgba(0,255,136,0.2); color: #00ff88; }
        .camera-status.offline { background: rgba(255,80,80,0.2); color: #ff5050; }
        .camera-actions { padding: 1rem; border-top: 1px solid rgba(255,255,255,0.05); display: flex; gap: 0.5rem; }
        .brand-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem; }
        .brand-item { background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .brand-item span { font-size: 1.5rem; display: block; margin-bottom: 0.5rem; }
        .empty-state { text-align: center; padding: 3rem; grid-column: 1/-1; }
        .empty-icon { font-size: 4rem; display: block; margin-bottom: 1rem; }
        .text-muted { color: #666; font-size: 0.9rem; margin: 0.5rem 0 1rem; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 1000; }
        .modal.show { display: flex; }
        .modal-content { background: #1a1a2e; border-radius: 12px; width: 90%; max-width: 400px; }
        .modal-header { display: flex; justify-content: space-between; padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .modal-close { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: flex-end; gap: 0.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: #888; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-primary { background: linear-gradient(90deg, #00d9ff, #00ff88); color: #0f0f1a; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-danger { background: rgba(255,80,80,0.2); color: #ff5050; }
        .btn-small { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
    </style>
</body>
</html>
