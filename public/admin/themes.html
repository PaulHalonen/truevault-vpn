<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Editor - Admin - TrueVault VPN</title>
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style id="theme-variables">:root{--colors-primary:#00d9ff;--colors-secondary:#00ff88;--colors-accent:#ff6b6b;--colors-background:#0f0f1a;--colors-background-secondary:#1a1a2e;--colors-text:#ffffff;--colors-text-muted:#888888;--colors-success:#00ff88;--colors-warning:#ffbb00;--colors-error:#ff5050;--gradients-primary:linear-gradient(90deg,#00d9ff,#00ff88);--gradients-background:linear-gradient(135deg,#0f0f1a,#1a1a2e);--buttons-border-radius:8px;--cards-border-radius:14px;--colors-border:rgba(255,255,255,0.08);--layout-sidebar-width:260px;}</style>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/dashboard.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
</head>
<body class="dashboard-body">
    <!-- Sidebar (same as dashboard) -->
    <aside class="sidebar admin-sidebar">
        <div class="sidebar-header">
            <span class="logo-icon">üõ°Ô∏è</span>
            <h1>TrueVault</h1>
            <span class="admin-label">ADMIN</span>
        </div>
        <nav class="sidebar-nav">
            <a href="/admin/dashboard.html" class="nav-item"><span class="nav-icon">üìä</span><span>Dashboard</span></a>
            <a href="/admin/users.html" class="nav-item"><span class="nav-icon">üë•</span><span>Users</span></a>
            <a href="/admin/servers.html" class="nav-item"><span class="nav-icon">üñ•Ô∏è</span><span>Servers</span></a>
            <a href="/admin/subscriptions.html" class="nav-item"><span class="nav-icon">üí≥</span><span>Subscriptions</span></a>
            <a href="/admin/payments.html" class="nav-item"><span class="nav-icon">üí∞</span><span>Payments</span></a>
            <div class="nav-divider"></div>
            <div class="nav-label">CMS</div>
            <a href="/admin/pages.html" class="nav-item"><span class="nav-icon">üìÑ</span><span>Pages</span></a>
            <a href="/admin/themes.html" class="nav-item active"><span class="nav-icon">üé®</span><span>Theme Editor</span></a>
            <a href="/admin/emails.html" class="nav-item"><span class="nav-icon">üìß</span><span>Email Templates</span></a>
            <a href="/admin/media.html" class="nav-item"><span class="nav-icon">üñºÔ∏è</span><span>Media Library</span></a>
            <div class="nav-divider"></div>
            <div class="nav-label">System</div>
            <a href="/admin/automation.html" class="nav-item"><span class="nav-icon">‚ö°</span><span>Automation</span></a>
            <a href="/admin/logs.html" class="nav-item"><span class="nav-icon">üìã</span><span>System Logs</span></a>
            <a href="/admin/settings.html" class="nav-item"><span class="nav-icon">‚öôÔ∏è</span><span>Settings</span></a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar admin-avatar">üë§</div>
                <div class="user-details">
                    <span class="user-name" id="adminName">Administrator</span>
                    <span class="user-plan">Super Admin</span>
                </div>
            </div>
            <button class="btn btn-secondary btn-small" onclick="adminLogout()">Logout</button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
            <div>
                <h1>üé® Theme Editor</h1>
                <p class="text-muted">Customize all visual styles - changes apply immediately across the entire site</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="resetTheme()">Reset to Default</button>
                <button class="btn btn-primary" onclick="saveTheme()" id="saveBtn">üíæ Save Changes</button>
            </div>
        </header>
        
        <div class="theme-editor-layout">
            <!-- Settings Panel -->
            <div class="theme-settings">
                <!-- Colors Section -->
                <div class="settings-section">
                    <h3>üé® Colors</h3>
                    <div class="settings-grid">
                        <div class="color-input">
                            <label>Primary</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-primary" value="#00d9ff" onchange="updateTheme(this)">
                                <input type="text" id="colors-primary-text" value="#00d9ff" onchange="updateFromText(this, 'colors-primary')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Secondary</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-secondary" value="#00ff88" onchange="updateTheme(this)">
                                <input type="text" id="colors-secondary-text" value="#00ff88" onchange="updateFromText(this, 'colors-secondary')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Accent</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-accent" value="#ff6b6b" onchange="updateTheme(this)">
                                <input type="text" id="colors-accent-text" value="#ff6b6b" onchange="updateFromText(this, 'colors-accent')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Background</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-background" value="#0f0f1a" onchange="updateTheme(this)">
                                <input type="text" id="colors-background-text" value="#0f0f1a" onchange="updateFromText(this, 'colors-background')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Success</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-success" value="#00ff88" onchange="updateTheme(this)">
                                <input type="text" id="colors-success-text" value="#00ff88" onchange="updateFromText(this, 'colors-success')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Warning</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-warning" value="#ffbb00" onchange="updateTheme(this)">
                                <input type="text" id="colors-warning-text" value="#ffbb00" onchange="updateFromText(this, 'colors-warning')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Error</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-error" value="#ff5050" onchange="updateTheme(this)">
                                <input type="text" id="colors-error-text" value="#ff5050" onchange="updateFromText(this, 'colors-error')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Text Primary</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-text" value="#ffffff" onchange="updateTheme(this)">
                                <input type="text" id="colors-text-text" value="#ffffff" onchange="updateFromText(this, 'colors-text')">
                            </div>
                        </div>
                        <div class="color-input">
                            <label>Text Muted</label>
                            <div class="color-picker-input">
                                <input type="color" id="colors-text-muted" value="#888888" onchange="updateTheme(this)">
                                <input type="text" id="colors-text-muted-text" value="#888888" onchange="updateFromText(this, 'colors-text-muted')">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Typography Section -->
                <div class="settings-section">
                    <h3>‚úèÔ∏è Typography</h3>
                    <div class="form-group">
                        <label>Font Family</label>
                        <select id="typography-font-family" onchange="updateTypography(this)">
                            <option value="'Inter', -apple-system, sans-serif">Inter (Default)</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                            <option value="'Open Sans', sans-serif">Open Sans</option>
                            <option value="'Poppins', sans-serif">Poppins</option>
                            <option value="'Montserrat', sans-serif">Montserrat</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Base Font Size</label>
                        <select id="typography-font-size-base" onchange="updateTypography(this)">
                            <option value="14px">14px (Small)</option>
                            <option value="16px" selected>16px (Default)</option>
                            <option value="18px">18px (Large)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Buttons Section -->
                <div class="settings-section">
                    <h3>üîò Buttons</h3>
                    <div class="form-group">
                        <label>Border Radius</label>
                        <div class="range-input">
                            <input type="range" id="buttons-border-radius" min="0" max="20" value="8" onchange="updateButtons(this)">
                            <span id="buttons-border-radius-value">8px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Font Weight</label>
                        <select id="buttons-font-weight" onchange="updateButtons(this)">
                            <option value="400">Normal (400)</option>
                            <option value="500">Medium (500)</option>
                            <option value="600" selected>Semi-Bold (600)</option>
                            <option value="700">Bold (700)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Cards Section -->
                <div class="settings-section">
                    <h3>üÉè Cards</h3>
                    <div class="form-group">
                        <label>Border Radius</label>
                        <div class="range-input">
                            <input type="range" id="cards-border-radius" min="0" max="30" value="14" onchange="updateCards(this)">
                            <span id="cards-border-radius-value">14px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Padding</label>
                        <select id="cards-padding" onchange="updateCards(this)">
                            <option value="15px">Small (15px)</option>
                            <option value="20px" selected>Medium (20px)</option>
                            <option value="25px">Large (25px)</option>
                            <option value="30px">Extra Large (30px)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Live Preview -->
            <div class="theme-preview-panel">
                <h3>üëÅÔ∏è Live Preview</h3>
                <div class="preview-container" id="previewContainer">
                    <div class="preview-card">
                        <div class="preview-header">
                            <span class="preview-logo">üõ°Ô∏è TrueVault VPN</span>
                            <button class="btn btn-primary btn-small">Connect</button>
                        </div>
                        <div class="preview-content">
                            <h4>Server Selection</h4>
                            <p class="text-muted">Choose a server to connect</p>
                            <div class="preview-server">
                                <span>üá∫üá∏ US East</span>
                                <span class="badge badge-success">Online</span>
                            </div>
                            <div class="preview-server">
                                <span>üá®üá¶ Canada</span>
                                <span class="badge badge-success">Online</span>
                            </div>
                            <div class="preview-buttons">
                                <button class="btn btn-primary">Primary Button</button>
                                <button class="btn btn-secondary">Secondary</button>
                            </div>
                            <div class="preview-badges">
                                <span class="badge badge-success">Success</span>
                                <span class="badge badge-warning">Warning</span>
                                <span class="badge badge-error">Error</span>
                                <span class="badge badge-info">Info</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <style>
        .theme-editor-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
        }
        
        .theme-settings {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .settings-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--colors-border);
            border-radius: var(--cards-border-radius);
            padding: 20px;
        }
        
        .settings-section h3 {
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .color-input {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .color-input label {
            font-size: 0.85rem;
            color: var(--colors-text-muted);
        }
        
        .color-picker-input {
            display: flex;
            gap: 8px;
        }
        
        .color-picker-input input[type="color"] {
            width: 40px;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }
        
        .color-picker-input input[type="text"] {
            flex: 1;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .range-input {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-input input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .range-input input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--colors-primary);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .range-input span {
            min-width: 45px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .theme-preview-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--colors-border);
            border-radius: var(--cards-border-radius);
            padding: 20px;
        }
        
        .theme-preview-panel h3 {
            margin-bottom: 20px;
        }
        
        .preview-container {
            background: var(--colors-background);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
        }
        
        .preview-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--colors-border);
            border-radius: var(--cards-border-radius);
            overflow: hidden;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--colors-border);
        }
        
        .preview-logo {
            font-weight: 600;
            background: var(--gradients-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .preview-content {
            padding: 20px;
        }
        
        .preview-content h4 {
            margin-bottom: 5px;
        }
        
        .preview-server {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .preview-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .preview-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 1024px) {
            .theme-editor-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <script src="/assets/js/theme-loader.js"></script>
    <script src="/assets/js/app.js"></script>
    <script>
        let themeSettings = {};
        let hasChanges = false;
        
        function checkAdminAuth() {
            const token = localStorage.getItem('truevault_admin_token');
            if (!token) {
                window.location.href = '/admin/';
                return false;
            }
            return true;
        }
        
        function adminLogout() {
            localStorage.removeItem('truevault_admin_token');
            localStorage.removeItem('truevault_admin');
            window.location.href = '/admin/';
        }
        
        async function loadThemeSettings() {
            try {
                const response = await fetch('/api/theme/index.php');
                const data = await response.json();
                
                if (data.success && data.data.settings) {
                    themeSettings = data.data.settings;
                    applySettingsToForm(themeSettings);
                }
            } catch (error) {
                console.error('Failed to load theme:', error);
            }
        }
        
        function applySettingsToForm(settings) {
            // Apply colors
            if (settings.colors) {
                for (const [key, value] of Object.entries(settings.colors)) {
                    const colorInput = document.getElementById(`colors-${key}`);
                    const textInput = document.getElementById(`colors-${key}-text`);
                    if (colorInput) {
                        colorInput.value = value;
                    }
                    if (textInput) {
                        textInput.value = value;
                    }
                }
            }
            
            // Apply typography
            if (settings.typography) {
                if (settings.typography.font_family) {
                    document.getElementById('typography-font-family').value = settings.typography.font_family;
                }
                if (settings.typography.font_size_base) {
                    document.getElementById('typography-font-size-base').value = settings.typography.font_size_base;
                }
            }
            
            // Apply buttons
            if (settings.buttons) {
                if (settings.buttons.border_radius) {
                    const radius = parseInt(settings.buttons.border_radius);
                    document.getElementById('buttons-border-radius').value = radius;
                    document.getElementById('buttons-border-radius-value').textContent = radius + 'px';
                }
            }
            
            // Apply cards
            if (settings.cards) {
                if (settings.cards.border_radius) {
                    const radius = parseInt(settings.cards.border_radius);
                    document.getElementById('cards-border-radius').value = radius;
                    document.getElementById('cards-border-radius-value').textContent = radius + 'px';
                }
            }
        }
        
        function updateTheme(input) {
            const id = input.id;
            const value = input.value;
            const textInput = document.getElementById(id + '-text');
            if (textInput) {
                textInput.value = value;
            }
            
            // Update CSS variable
            const varName = '--' + id.replace(/-/g, '-');
            document.documentElement.style.setProperty(varName, value);
            
            // Store change
            const [category, ...keyParts] = id.split('-');
            const key = keyParts.join('_');
            if (!themeSettings[category]) themeSettings[category] = {};
            themeSettings[category][key] = value;
            
            markChanged();
        }
        
        function updateFromText(input, colorId) {
            const value = input.value;
            const colorInput = document.getElementById(colorId);
            if (colorInput && /^#[0-9A-Fa-f]{6}$/.test(value)) {
                colorInput.value = value;
                updateTheme(colorInput);
            }
        }
        
        function updateTypography(select) {
            const id = select.id;
            const value = select.value;
            const varName = '--' + id.replace(/-/g, '-');
            document.documentElement.style.setProperty(varName, value);
            
            const [category, ...keyParts] = id.split('-');
            const key = keyParts.join('_');
            if (!themeSettings[category]) themeSettings[category] = {};
            themeSettings[category][key] = value;
            
            markChanged();
        }
        
        function updateButtons(input) {
            const id = input.id;
            let value = input.value;
            
            if (input.type === 'range') {
                value = value + 'px';
                document.getElementById(id + '-value').textContent = value;
            }
            
            const varName = '--' + id.replace(/-/g, '-');
            document.documentElement.style.setProperty(varName, value);
            
            const [category, ...keyParts] = id.split('-');
            const key = keyParts.join('_');
            if (!themeSettings[category]) themeSettings[category] = {};
            themeSettings[category][key] = value;
            
            markChanged();
        }
        
        function updateCards(input) {
            updateButtons(input); // Same logic
        }
        
        function markChanged() {
            hasChanges = true;
            document.getElementById('saveBtn').classList.add('btn-warning');
            document.getElementById('saveBtn').textContent = 'üíæ Save Changes*';
        }
        
        async function saveTheme() {
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            btn.textContent = 'Saving...';
            
            try {
                const token = localStorage.getItem('truevault_admin_token');
                const response = await fetch('/api/admin/theme.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ settings: themeSettings })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    TrueVault.Toast.success('Theme saved successfully!');
                    hasChanges = false;
                    btn.classList.remove('btn-warning');
                    btn.textContent = 'üíæ Save Changes';
                    
                    // Clear theme cache
                    localStorage.removeItem('truevault_theme');
                } else {
                    TrueVault.Toast.error(result.error || 'Failed to save theme');
                }
            } catch (error) {
                TrueVault.Toast.error('Connection error');
            }
            
            btn.disabled = false;
        }
        
        function resetTheme() {
            if (confirm('Reset all theme settings to default? This cannot be undone.')) {
                // Reset to defaults
                window.location.reload();
            }
        }
        
        // Warn before leaving with unsaved changes
        window.onbeforeunload = function() {
            if (hasChanges) {
                return 'You have unsaved changes. Are you sure you want to leave?';
            }
        };
        
        // Initialize
        if (checkAdminAuth()) {
            loadThemeSettings();
            
            const admin = JSON.parse(localStorage.getItem('truevault_admin') || '{}');
            document.getElementById('adminName').textContent = admin.first_name || 'Administrator';
        }
    </script>
</body>
</html>
