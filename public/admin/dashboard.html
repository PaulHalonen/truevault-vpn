<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TrueVault VPN</title>
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style id="theme-variables">:root{--colors-primary:#00d9ff;--colors-secondary:#00ff88;--colors-accent:#ff6b6b;--colors-background:#0f0f1a;--colors-background-secondary:#1a1a2e;--colors-text:#ffffff;--colors-text-muted:#888888;--colors-success:#00ff88;--colors-warning:#ffbb00;--colors-error:#ff5050;--gradients-primary:linear-gradient(90deg,#00d9ff,#00ff88);--gradients-background:linear-gradient(135deg,#0f0f1a,#1a1a2e);--buttons-border-radius:8px;--cards-border-radius:14px;--colors-border:rgba(255,255,255,0.08);--layout-sidebar-width:260px;}</style>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/dashboard.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
</head>
<body class="dashboard-body">
    <!-- Sidebar -->
    <aside class="sidebar admin-sidebar">
        <div class="sidebar-header">
            <span class="logo-icon">üõ°Ô∏è</span>
            <h1>TrueVault</h1>
            <span class="admin-label">ADMIN</span>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/admin/dashboard.html" class="nav-item active">
                <span class="nav-icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="/admin/users.html" class="nav-item">
                <span class="nav-icon">üë•</span>
                <span>Users</span>
            </a>
            <a href="/admin/servers.html" class="nav-item">
                <span class="nav-icon">üñ•Ô∏è</span>
                <span>Servers</span>
            </a>
            <a href="/admin/subscriptions.html" class="nav-item">
                <span class="nav-icon">üí≥</span>
                <span>Subscriptions</span>
            </a>
            <a href="/admin/payments.html" class="nav-item">
                <span class="nav-icon">üí∞</span>
                <span>Payments</span>
            </a>
            
            <div class="nav-divider"></div>
            <div class="nav-label">CMS</div>
            
            <a href="/admin/pages.html" class="nav-item">
                <span class="nav-icon">üìÑ</span>
                <span>Pages</span>
            </a>
            <a href="/admin/themes.html" class="nav-item">
                <span class="nav-icon">üé®</span>
                <span>Theme Editor</span>
            </a>
            <a href="/admin/emails.html" class="nav-item">
                <span class="nav-icon">üìß</span>
                <span>Email Templates</span>
            </a>
            <a href="/admin/media.html" class="nav-item">
                <span class="nav-icon">üñºÔ∏è</span>
                <span>Media Library</span>
            </a>
            
            <div class="nav-divider"></div>
            <div class="nav-label">System</div>
            
            <a href="/admin/automation.html" class="nav-item">
                <span class="nav-icon">‚ö°</span>
                <span>Automation</span>
            </a>
            <a href="/admin/logs.html" class="nav-item">
                <span class="nav-icon">üìã</span>
                <span>System Logs</span>
            </a>
            <a href="/admin/settings.html" class="nav-item">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar admin-avatar">üë§</div>
                <div class="user-details">
                    <span class="user-name" id="adminName">Administrator</span>
                    <span class="user-plan" id="adminRole">Super Admin</span>
                </div>
            </div>
            <button class="btn btn-secondary btn-small" onclick="adminLogout()">Logout</button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
            <div>
                <h1>Admin Dashboard</h1>
                <p class="text-muted">TrueVault VPN System Overview</p>
            </div>
            <div class="header-actions">
                <span class="badge badge-success" id="systemStatus">System Online</span>
            </div>
        </header>
        
        <!-- Quick Stats -->
        <section class="admin-stats-grid">
            <div class="admin-stat-card">
                <div class="admin-stat-icon users">üë•</div>
                <div class="admin-stat-content">
                    <span class="admin-stat-value" id="totalUsers">0</span>
                    <span class="admin-stat-label">Total Users</span>
                    <span class="admin-stat-change positive" id="usersChange">+0 this week</span>
                </div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-icon active">üü¢</div>
                <div class="admin-stat-content">
                    <span class="admin-stat-value" id="activeConnections">0</span>
                    <span class="admin-stat-label">Active Connections</span>
                    <span class="admin-stat-change" id="connectionsInfo">across all servers</span>
                </div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-icon revenue">üí∞</div>
                <div class="admin-stat-content">
                    <span class="admin-stat-value" id="monthlyRevenue">$0</span>
                    <span class="admin-stat-label">Monthly Revenue</span>
                    <span class="admin-stat-change positive" id="revenueChange">+0%</span>
                </div>
            </div>
            <div class="admin-stat-card">
                <div class="admin-stat-icon servers">üñ•Ô∏è</div>
                <div class="admin-stat-content">
                    <span class="admin-stat-value" id="activeServers">4/4</span>
                    <span class="admin-stat-label">Servers Online</span>
                    <span class="admin-stat-change" id="serverLoad">Avg load: 0%</span>
                </div>
            </div>
        </section>
        
        <!-- Server Status -->
        <section class="admin-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üñ•Ô∏è Server Status</h3>
                    <a href="/admin/servers.html" class="text-primary">Manage ‚Üí</a>
                </div>
                <div class="server-status-list" id="serverStatusList">
                    <div class="loading">Loading servers...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìà Recent Activity</h3>
                    <a href="/admin/logs.html" class="text-primary">View All ‚Üí</a>
                </div>
                <div class="activity-list" id="activityList">
                    <div class="loading">Loading activity...</div>
                </div>
            </div>
        </section>
        
        <!-- Quick Actions -->
        <section class="admin-actions">
            <h3>Quick Actions</h3>
            <div class="action-grid">
                <a href="/admin/users.html?action=create" class="action-card">
                    <span class="action-icon">‚ûï</span>
                    <span>Add User</span>
                </a>
                <a href="/admin/servers.html?action=create" class="action-card">
                    <span class="action-icon">üñ•Ô∏è</span>
                    <span>Add Server</span>
                </a>
                <a href="/admin/themes.html" class="action-card">
                    <span class="action-icon">üé®</span>
                    <span>Edit Theme</span>
                </a>
                <a href="/admin/emails.html" class="action-card">
                    <span class="action-icon">üìß</span>
                    <span>Email Templates</span>
                </a>
                <a href="https://new.contabo.com/network/vpc" target="_blank" class="action-card external">
                    <span class="action-icon">‚òÅÔ∏è</span>
                    <span>Contabo Panel</span>
                </a>
                <a href="/admin/automation.html" class="action-card">
                    <span class="action-icon">‚ö°</span>
                    <span>Automation</span>
                </a>
            </div>
        </section>
        
        <!-- Recent Users & Subscriptions -->
        <section class="admin-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üë• Recent Users</h3>
                    <a href="/admin/users.html" class="text-primary">View All ‚Üí</a>
                </div>
                <div class="users-table" id="recentUsers">
                    <div class="loading">Loading users...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üí≥ Recent Payments</h3>
                    <a href="/admin/payments.html" class="text-primary">View All ‚Üí</a>
                </div>
                <div class="payments-table" id="recentPayments">
                    <div class="loading">Loading payments...</div>
                </div>
            </div>
        </section>
    </main>
    
    <script src="/assets/js/theme-loader.js"></script>
    <script src="/assets/js/app.js"></script>
    <script>
        // Check admin auth
        function checkAdminAuth() {
            const token = localStorage.getItem('truevault_admin_token');
            if (!token) {
                window.location.href = '/admin/';
                return false;
            }
            return true;
        }
        
        function adminLogout() {
            localStorage.removeItem('truevault_admin_token');
            localStorage.removeItem('truevault_admin');
            window.location.href = '/admin/';
        }
        
        async function adminAPI(endpoint, options = {}) {
            const token = localStorage.getItem('truevault_admin_token');
            const response = await fetch(`/api${endpoint}`, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            });
            return response.json();
        }
        
        async function loadDashboard() {
            // Load admin info
            const admin = JSON.parse(localStorage.getItem('truevault_admin') || '{}');
            document.getElementById('adminName').textContent = admin.first_name || 'Administrator';
            document.getElementById('adminRole').textContent = admin.role_name || 'Admin';
            
            // Load stats (mock data for now - will connect to real API)
            document.getElementById('totalUsers').textContent = '127';
            document.getElementById('usersChange').textContent = '+12 this week';
            document.getElementById('activeConnections').textContent = '43';
            document.getElementById('monthlyRevenue').textContent = '$1,847';
            document.getElementById('revenueChange').textContent = '+15%';
            document.getElementById('activeServers').textContent = '4/4';
            document.getElementById('serverLoad').textContent = 'Avg load: 34%';
            
            // Load servers
            loadServerStatus();
            
            // Load activity
            loadActivity();
            
            // Load recent users
            loadRecentUsers();
            
            // Load recent payments
            loadRecentPayments();
        }
        
        function loadServerStatus() {
            const container = document.getElementById('serverStatusList');
            const servers = [
                { name: 'US East (Contabo)', ip: '66.94.103.91', status: 'active', load: 42, type: 'shared' },
                { name: 'US Central VIP', ip: '144.126.133.253', status: 'active', load: 8, type: 'vip', vipUser: 'seige235@yahoo.com' },
                { name: 'US South (Fly.io)', ip: '66.241.124.4', status: 'active', load: 38, type: 'shared' },
                { name: 'Canada (Fly.io)', ip: '66.241.125.247', status: 'active', load: 51, type: 'shared' }
            ];
            
            container.innerHTML = servers.map(s => `
                <div class="server-status-item">
                    <div class="server-status-info">
                        <span class="status-dot ${s.status === 'active' ? 'online' : ''}"></span>
                        <div>
                            <span class="server-name">${s.name}</span>
                            <span class="server-ip text-muted">${s.ip}</span>
                            ${s.type === 'vip' ? `<span class="badge badge-warning">VIP: ${s.vipUser}</span>` : ''}
                        </div>
                    </div>
                    <div class="server-status-load">
                        <div class="load-bar">
                            <div class="load-fill ${s.load > 70 ? 'high' : s.load > 40 ? 'medium' : 'low'}" style="width: ${s.load}%"></div>
                        </div>
                        <span class="load-text">${s.load}%</span>
                    </div>
                </div>
            `).join('');
        }
        
        function loadActivity() {
            const container = document.getElementById('activityList');
            const activities = [
                { icon: 'üë§', text: 'New user registered', detail: 'john@example.com', time: '2 min ago' },
                { icon: 'üîå', text: 'VPN connection', detail: 'US East server', time: '5 min ago' },
                { icon: 'üí≥', text: 'Payment received', detail: '$14.99 - Family Plan', time: '15 min ago' },
                { icon: 'üì∑', text: 'Camera synced', detail: '3 devices from scanner', time: '1 hour ago' },
                { icon: 'üîê', text: 'Certificate generated', detail: 'Root CA', time: '2 hours ago' }
            ];
            
            container.innerHTML = activities.map(a => `
                <div class="activity-item">
                    <span class="activity-icon">${a.icon}</span>
                    <div class="activity-content">
                        <span class="activity-text">${a.text}</span>
                        <span class="activity-detail text-muted">${a.detail}</span>
                    </div>
                    <span class="activity-time text-muted">${a.time}</span>
                </div>
            `).join('');
        }
        
        function loadRecentUsers() {
            const container = document.getElementById('recentUsers');
            const users = [
                { name: 'John Doe', email: 'john@example.com', plan: 'Family', status: 'active' },
                { name: 'Jane Smith', email: 'jane@example.com', plan: 'Personal', status: 'active' },
                { name: 'Bob Wilson', email: 'bob@example.com', plan: 'Trial', status: 'trial' }
            ];
            
            container.innerHTML = `
                <table class="admin-table">
                    <thead><tr><th>User</th><th>Plan</th><th>Status</th></tr></thead>
                    <tbody>
                        ${users.map(u => `
                            <tr>
                                <td><strong>${u.name}</strong><br><span class="text-muted">${u.email}</span></td>
                                <td>${u.plan}</td>
                                <td><span class="badge badge-${u.status === 'active' ? 'success' : 'info'}">${u.status}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function loadRecentPayments() {
            const container = document.getElementById('recentPayments');
            const payments = [
                { user: 'john@example.com', amount: '$14.99', plan: 'Family', date: 'Jan 11, 2026' },
                { user: 'jane@example.com', amount: '$9.99', plan: 'Personal', date: 'Jan 10, 2026' },
                { user: 'alice@example.com', amount: '$29.99', plan: 'Business', date: 'Jan 9, 2026' }
            ];
            
            container.innerHTML = `
                <table class="admin-table">
                    <thead><tr><th>User</th><th>Amount</th><th>Date</th></tr></thead>
                    <tbody>
                        ${payments.map(p => `
                            <tr>
                                <td>${p.user}</td>
                                <td><strong class="text-success">${p.amount}</strong></td>
                                <td class="text-muted">${p.date}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Initialize
        if (checkAdminAuth()) {
            loadDashboard();
        }
    </script>
</body>
</html>
