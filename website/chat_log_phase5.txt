
=================================================================
PHASE 5: PAYPAL BILLING - January 16, 2026
=================================================================

PRICING CORRECTED:
- Personal:   $9.97/mo  | $99.97/yr   | 3 devices
- Family:    $14.97/mo  | $140.97/yr  | 6 devices  
- Dedicated: $39.97/mo  | $399.97/yr  | unlimited devices

FILES CREATED:

1. includes/PayPal.php
   - Complete PayPal integration class
   - Order creation and capture
   - Subscription management
   - Webhook processing
   - Invoice generation

2. api/billing/plans.php
   - GET endpoint for plan pricing
   - Supports USD and CAD currencies
   - Returns formatted pricing with savings calculations

3. api/billing/checkout.php
   - POST endpoint to create checkout session
   - Validates plan, interval, currency
   - Creates PayPal order
   - Stores pending order in database
   - VIP bypass (free access)

4. api/billing/subscription.php
   - GET: Current subscription status
   - POST ?action=capture: Capture approved payment
   - POST ?action=cancel: Cancel subscription
   - Invoice generation on payment
   - User status update

5. api/billing/webhook.php
   - Receives PayPal webhook events
   - Logs all webhooks
   - Processes subscription/payment events
   - Updates user and subscription status

6. admin/setup-databases.php UPDATED
   - Added orders table to billing.db
   - Corrected pricing settings in main.db
   - Added webhook_logs table to logs.db
   - IP pool expanded to 253 addresses (10.8.0.2-254)
   - Family plan: 6 devices (not 10)

DATABASE CHANGES:
billing.db now includes:
- orders (pending PayPal orders)
- subscriptions
- invoices  
- payments

logs.db now includes:
- webhook_logs (PayPal webhook tracking)

=================================================================
